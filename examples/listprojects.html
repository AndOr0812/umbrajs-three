<html>
  <head>
    <title>Project API example</title>
  </head>
  <body>
    <pre id="info"></pre>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/108/three.min.js"></script>
    <script src="../dist/umbrajs-three.js"></script>

    <script>
'use strict';

function write(message) {
  let info = document.getElementById('info')
  info.textContent += 'Invalid token'
}

(async function () {
  let token = new URL(window.location.href).searchParams.get('key')

  if (!token) {
      write('Invalid token. Set "key" URL parameter to view projects.')
      return
  }

  info.textContent = 'Fetching projects...\n'

  var renderer = new THREE.WebGLRenderer()
  let Umbra = await UmbraRuntime.initWithThreeJS(renderer)

  try {
    // Call the low-level umbrajs lib directly
    let projects = await Umbra.lib.getProjects(token)

    write(`Found ${projects.length} projects:\n`)

    // Print out project infos
    for (let i = 0; i < projects.length; i++) {
      const p = projects[i]
      write(`${p.name} (${p.id}) (${p.organizationName})\n`)
      console.log(projects[i])
      for (let j = 0; j < p.models.length; j++) {
        const m = p.models[j]
        const isPublic = m.publicShare ? 'public' : 'private'
        write(`    ${m.name} ${m.id} ${isPublic}\n`)
      }
    }
  } catch (e) {
    write(`Failed: ${e}`)
  }
})()
    </script>
  </body>
</html>


