import{UnsignedByteType as e,RGBAFormat as t,UnsignedShort565Type as n,RGBFormat as r,LuminanceAlphaFormat as i,HalfFloatType as a,RGBA_S3TC_DXT1_Format as o,RGBA_S3TC_DXT5_Format as s,RGB_ETC1_Format as u,RGBA_ASTC_4x4_Format as c,RGB_PVRTC_4BPPV1_Format as l,Object3D as f,MeshBasicMaterial as d,Matrix4 as h,Vector3 as p,Box3 as m,TangentSpaceNormalMap as v,Mesh as y,CompressedTexture as g,DataTexture as b,LinearFilter as w,LinearEncoding as T,sRGBEncoding as A,BufferGeometry as x,Sphere as C,Float32BufferAttribute as _}from"three";function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var P,B=(P="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t;e=e||{},t||(t=void 0!==e?e:{});var n,r={};for(n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);t.arguments=[],t.thisProgram="./this.program",t.quit=function(e,t){throw t},t.preRun=[],t.postRun=[];var i="";document.currentScript&&(i=document.currentScript.src),P&&(i=P),i=0!==i.indexOf("blob:")?i.substr(0,i.lastIndexOf("/")+1):"";var a=t.print||("undefined"!=typeof console?console.log.bind(console):"undefined"!=typeof print?print:null),o=t.printErr||("undefined"!=typeof printErr?printErr:"undefined"!=typeof console&&console.warn.bind(console)||a);for(n in r)r.hasOwnProperty(n)&&(t[n]=r[n]);function s(e){var t=b[R>>2];return(e=t+e+15&-16)>Nt()&&cn(),b[R>>2]=e,t}r=void 0;var u,c={"f64-rem":function(e,t){return e%t},debugger:function(){}};"object"!==("undefined"==typeof WebAssembly?"undefined":E(WebAssembly))&&o("no native wasm support detected");var l,f=!1;function d(e,t){e||cn("Assertion failed: "+t)}function h(e){if("number"==typeof e)var t=!0,n=e;else t=!1,n=e.length;var r=nn(Math.max(n,1));if(t){for(e=r,d(0==(3&r)),t=r+(-4&n);e<t;e+=4)b[e>>2]=0;for(t=r+n;e<t;)m[e++>>0]=0;return r}return e.subarray||e.slice?v.set(e,r):v.set(new Uint8Array(e),r),r}var p,m,v,y,g,b,w,T,A,x="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function C(e,t,n){var r=t+n;for(n=t;e[n]&&!(n>=r);)++n;if(16<n-t&&e.subarray&&x)return x.decode(e.subarray(t,n));for(r="";t<n;){var i=e[t++];if(128&i){var a=63&e[t++];if(192==(224&i))r+=String.fromCharCode((31&i)<<6|a);else{var o=63&e[t++];65536>(i=224==(240&i)?(15&i)<<12|a<<6|o:(7&i)<<18|a<<12|o<<6|63&e[t++])?r+=String.fromCharCode(i):(i-=65536,r+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else r+=String.fromCharCode(i)}return r}function _(e){return e?C(v,e,void 0):""}function L(e,t,n,r){if(0<r){r=n+r-1;for(var i=0;i<e.length;++i){var a=e.charCodeAt(i);if(55296<=a&&57343>=a&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++i)),127>=a){if(n>=r)break;t[n++]=a}else{if(2047>=a){if(n+1>=r)break;t[n++]=192|a>>6}else{if(65535>=a){if(n+2>=r)break;t[n++]=224|a>>12}else{if(n+3>=r)break;t[n++]=240|a>>18,t[n++]=128|a>>12&63}t[n++]=128|a>>6&63}t[n++]=128|63&a}}t[n]=0}}function S(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),127>=r?++t:t=2047>=r?t+2:65535>=r?t+3:t+4}return t}function B(e){return 0<e%65536&&(e+=65536-e%65536),e}function M(){t.HEAP8=m=new Int8Array(p),t.HEAP16=y=new Int16Array(p),t.HEAP32=b=new Int32Array(p),t.HEAPU8=v=new Uint8Array(p),t.HEAPU16=g=new Uint16Array(p),t.HEAPU32=w=new Uint32Array(p),t.HEAPF32=T=new Float32Array(p),t.HEAPF64=A=new Float64Array(p)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var R=18576,U=t.TOTAL_MEMORY||134217728;function F(e){for(;0<e.length;){var n=e.shift();if("function"==typeof n)n();else{var r=n.eb;"number"==typeof r?void 0===n.Wa?t.dynCall_v(r):t.dynCall_vi(r,n.Wa):r(void 0===n.Wa?null:n.Wa)}}}5242880>U&&o("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+U+"! (TOTAL_STACK=5242880)"),(l=t.wasmMemory?t.wasmMemory:new WebAssembly.Memory({initial:U/65536}))&&(p=l.buffer),U=p.byteLength,M(),b[R>>2]=5261488;var k=[],O=[],D=[],I=[],j=[],W=!1;function z(){var e=t.preRun.shift();k.unshift(e)}var N=0,G=null,V=null;function q(){var e=H;return String.prototype.startsWith?e.startsWith("data:application/octet-stream;base64,"):0===e.indexOf("data:application/octet-stream;base64,")}t.preloadedImages={},t.preloadedAudios={};var H="umbra.wasm";if(!q()){var X=H;H=t.locateFile?t.locateFile(X,i):i+X}function J(){try{if(t.wasmBinary)return new Uint8Array(t.wasmBinary);throw"both async and sync fetching of the wasm failed"}catch(e){cn(e)}}function Y(e){function n(e){t.asm=e.exports,N--,t.monitorRunDependencies&&t.monitorRunDependencies(N),0==N&&(null!==G&&(clearInterval(G),G=null),V&&(e=V,V=null,e()))}function r(e){n(e.instance)}function i(e){return(t.wasmBinary||"function"!=typeof fetch?new Promise(function(e){e(J())}):fetch(H,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+H+"'";return e.arrayBuffer()}).catch(function(){return J()})).then(function(e){return WebAssembly.instantiate(e,a)}).then(e,function(e){o("failed to asynchronously prepare wasm: "+e),cn(e)})}var a={env:e,global:{NaN:NaN,Infinity:1/0},"global.Math":Math,asm2wasm:c};if(N++,t.monitorRunDependencies&&t.monitorRunDependencies(N),t.instantiateWasm)try{return t.instantiateWasm(a,n)}catch(e){return o("Module.instantiateWasm callback failed with error: "+e),!1}return function(){if(t.wasmBinary||"function"!=typeof WebAssembly.instantiateStreaming||q()||"function"!=typeof fetch)return i(r);fetch(H,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,a).then(r,function(e){o("wasm streaming compile failed: "+e),o("falling back to ArrayBuffer instantiation"),i(r)})})}(),{}}t.asm=function(e,t){return t.memory=l,t.table=new WebAssembly.Table({initial:543,maximum:543,element:"anyfunc"}),t.__memory_base=1024,t.__table_base=0,Y(t)};var Q=[function(){alert("Invalid http method.")},function(e,n,r,i,a,o,s,u,c,l,f){return function(e,n,r,i,a,o,s,u,c,l,f){var d=_(e);n=_(n),o=_(o);var h=new XMLHttpRequest;h.open(n,d,!0),("GET"!=n||0!=o.length)&&(h.withCredentials=!0),h.responseType="arraybuffer";var p=function(){var e=zt;return zt++,e}();if(h.onload=function(){if(200==h.status){var n=new Uint8Array(h.response),o=t.URLsDownloaded;t.maxBytesDownloaded+=h.response.byteLength,o.has(e)||(o.add(e),t.minBytesDownloaded+=h.response.byteLength),l?n.length!=f?t.dynCall_viii(a,p,r,0):(v.set(n,l),t.dynCall_viiii(i,p,r,null,0)):(o=nn(n.length),v.set(n,o),t.dynCall_viiii(i,p,r,o,n.length),tn(o))}else t.dynCall_viii(a,p,r,h.status);delete Wt[p]},h.onerror=function(){t.dynCall_viii(a,p,r,h.status),delete Wt[p]},h.onabort=function(){delete Wt[p]},0!=o.length&&h.setRequestHeader("Authorization","Basic "+btoa(o+":")),2<=(c=_(c).split("\n")).length)for(d=0;d<c.length;d+=2)h.setRequestHeader(c[d],c[d+1]);return"POST"==n?h.send(m.slice(s,s+u)):h.send(null),Wt[p]=h,p}(e,n,r,i,a,o,s,u,c,l,f)},function(){alert("Uploads are not supported.")}];O.push({eb:function(){rn()}});var Z={},K=[null,[],[]];function $(e,t){var n=K[e];0===t||10===t?((1===e?a:o)(C(n,0)),n.length=0):n.push(t)}var ee=0;function te(){return b[(ee+=4)-4>>2]}var ne={},re={};function ie(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function ae(e){return this.fromWireType(w[e>>2])}var oe={},se={},ue={};function ce(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return 48<=t&&57>=t?"_"+e:e}function le(e,t){return e=ce(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function fe(e){var t=Error,n=le(e,function(t){this.name=e,this.message=t,void 0!==(t=Error(t).stack)&&(this.stack=this.toString()+"\n"+t.replace(/^Error(:[^\n]*)?\n/,""))});return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},n}var de=void 0;function he(e){throw new de(e)}function pe(e,t,n){function r(t){(t=n(t)).length!==e.length&&he("Mismatched type converter count");for(var r=0;r<e.length;++r)we(e[r],t[r])}e.forEach(function(e){ue[e]=t});var i=Array(t.length),a=[],o=0;t.forEach(function(e,t){se.hasOwnProperty(e)?i[t]=se[e]:(a.push(e),oe.hasOwnProperty(e)||(oe[e]=[]),oe[e].push(function(){i[t]=se[e],++o===a.length&&r(i)}))}),0===a.length&&r(i)}function me(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var ve=void 0;function ye(e){for(var t="";v[e];)t+=ve[v[e++]];return t}var ge=void 0;function be(e){throw new ge(e)}function we(e,t,n){if(n=n||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var r=t.name;if(e||be('type "'+r+'" must have a positive integer typeid pointer'),se.hasOwnProperty(e)){if(n.zb)return;be("Cannot register type '"+r+"' twice")}se[e]=t,delete ue[e],oe.hasOwnProperty(e)&&(t=oe[e],delete oe[e],t.forEach(function(e){e()}))}function Te(e){return{count:e.count,Va:e.Va,Za:e.Za,Ma:e.Ma,Oa:e.Oa,Pa:e.Pa,Ra:e.Ra}}function Ae(e){be(e.La.Oa.Na.name+" instance already deleted")}var xe=!1;function Ce(){}function _e(e){--e.count.value,0===e.count.value&&(e.Pa?e.Ra.Ua(e.Pa):e.Oa.Na.Ua(e.Ma))}function Ee(e){return"undefined"==typeof FinalizationGroup?(Ee=function(e){return e},e):(xe=new FinalizationGroup(function(e){for(var t=e.next();!t.done;t=e.next())(t=t.value).Ma?_e(t):console.warn("object already deleted: "+t.Ma)}),Ce=function(e){xe.unregister(e.La)},(Ee=function(e){return xe.register(e,e.La,e.La),e})(e))}var Le=void 0,Se=[];function Pe(){for(;Se.length;){var e=Se.pop();e.La.Va=!1,e.delete()}}function Be(){}var Me={};function Re(e,n,r){t.hasOwnProperty(e)?((void 0===r||void 0!==t[e].Ta&&void 0!==t[e].Ta[r])&&be("Cannot register public name '"+e+"' twice"),function(e,n){var r=t;if(void 0===r[e].Ta){var i=r[e];r[e]=function(){return r[e].Ta.hasOwnProperty(arguments.length)||be("Function '"+n+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+r[e].Ta+")!"),r[e].Ta[arguments.length].apply(this,arguments)},r[e].Ta=[],r[e].Ta[i.ob]=i}}(e,e),t.hasOwnProperty(r)&&be("Cannot register multiple overloads of a function with the same number of arguments ("+r+")!"),t[e].Ta[r]=n):(t[e]=n,void 0!==r&&(t[e].Tb=r))}function Ue(e,t,n,r,i,a,o,s){this.name=e,this.constructor=t,this.Ya=n,this.Ua=r,this.Sa=i,this.tb=a,this.$a=o,this.rb=s}function Fe(e,t,n){for(;t!==n;)t.$a||be("Expected null or instance of "+n.name+", got an instance of "+t.name),e=t.$a(e),t=t.Sa;return e}function ke(e,t){return null===t?(this.fb&&be("null is not a valid "+this.name),0):(t.La||be('Cannot pass "'+Ke(t)+'" as a '+this.name),t.La.Ma||be("Cannot pass deleted object as a pointer of type "+this.name),Fe(t.La.Ma,t.La.Oa.Na,this.Na))}function Oe(e,t){if(null===t){if(this.fb&&be("null is not a valid "+this.name),this.bb){var n=this.gb();return null!==e&&e.push(this.Ua,n),n}return 0}if(t.La||be('Cannot pass "'+Ke(t)+'" as a '+this.name),t.La.Ma||be("Cannot pass deleted object as a pointer of type "+this.name),!this.ab&&t.La.Oa.ab&&be("Cannot convert argument of type "+(t.La.Ra?t.La.Ra.name:t.La.Oa.name)+" to parameter type "+this.name),n=Fe(t.La.Ma,t.La.Oa.Na,this.Na),this.bb)switch(void 0===t.La.Pa&&be("Passing raw pointer to smart pointer is illegal"),this.Hb){case 0:t.La.Ra===this?n=t.La.Pa:be("Cannot convert argument of type "+(t.La.Ra?t.La.Ra.name:t.La.Oa.name)+" to parameter type "+this.name);break;case 1:n=t.La.Pa;break;case 2:if(t.La.Ra===this)n=t.La.Pa;else{var r=t.clone();n=this.Db(n,Ye(function(){r.delete()})),null!==e&&e.push(this.Ua,n)}break;default:be("Unsupporting sharing policy")}return n}function De(e,t){return null===t?(this.fb&&be("null is not a valid "+this.name),0):(t.La||be('Cannot pass "'+Ke(t)+'" as a '+this.name),t.La.Ma||be("Cannot pass deleted object as a pointer of type "+this.name),t.La.Oa.ab&&be("Cannot convert argument of type "+t.La.Oa.name+" to parameter type "+this.name),Fe(t.La.Ma,t.La.Oa.Na,this.Na))}var Ie={};function je(e,t){return t.Oa&&t.Ma||he("makeClassHandle requires ptr and ptrType"),!!t.Ra!=!!t.Pa&&he("Both smartPtrType and smartPtr must be specified"),t.count={value:1},Ee(Object.create(e,{La:{value:t}}))}function We(e,t,n,r){this.name=e,this.Na=t,this.fb=n,this.ab=r,this.bb=!1,this.Ua=this.Db=this.gb=this.nb=this.Hb=this.Bb=void 0,void 0!==t.Sa?this.toWireType=Oe:(this.toWireType=r?ke:De,this.Qa=null)}function ze(e,n,r){t.hasOwnProperty(e)||he("Replacing nonexistant public symbol"),void 0!==t[e].Ta&&void 0!==r?t[e].Ta[r]=n:(t[e]=n,t[e].ob=r)}function Ne(e,n){if(e=ye(e),void 0!==t["FUNCTION_TABLE_"+e])var r=t["FUNCTION_TABLE_"+e][n];else if("undefined"!=typeof FUNCTION_TABLE)r=FUNCTION_TABLE[n];else{void 0===(r=t["dynCall_"+e])&&void 0===(r=t["dynCall_"+e.replace(/f/g,"d")])&&be("No dynCall invoker for signature: "+e);for(var i=[],a=1;a<e.length;++a)i.push("a"+a);a="return function dynCall_"+e+"_"+n+"("+i.join(", ")+") {\n",a+="    return dynCall(rawFunction"+(i.length?", ":"")+i.join(", ")+");\n",r=new Function("dynCall","rawFunction",a+"};\n")(r,n)}return"function"!=typeof r&&be("unknown function pointer with signature "+e+": "+n),r}var Ge=void 0;function Ve(e){var t=ye(e=Zt(e));return tn(e),t}function qe(e,t){var n=[],r={};throw t.forEach(function e(t){r[t]||se[t]||(ue[t]?ue[t].forEach(e):(n.push(t),r[t]=!0))}),new Ge(e+": "+n.map(Ve).join([", "]))}var He=[],Xe=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Je(e){4<e&&0==--Xe[e].hb&&(Xe[e]=void 0,He.push(e))}function Ye(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=He.length?He.pop():Xe.length;return Xe[t]={hb:1,value:e},t}}function Qe(e,t,n){switch(t){case 0:return function(e){return this.fromWireType((n?m:v)[e])};case 1:return function(e){return this.fromWireType((n?y:g)[e>>1])};case 2:return function(e){return this.fromWireType((n?b:w)[e>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function Ze(e,t){var n=se[e];return void 0===n&&be(t+" has unknown type "+Ve(e)),n}function Ke(e){if(null===e)return"null";var t=E(e);return"object"===t||"array"===t||"function"===t?e.toString():""+e}function $e(e,t){switch(t){case 2:return function(e){return this.fromWireType(T[e>>2])};case 3:return function(e){return this.fromWireType(A[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function et(e){var t=Function;if(!(t instanceof Function))throw new TypeError("new_ called with constructor type "+E(t)+" which is not a function");var n=le(t.name||"unknownFunctionName",function(){});return n.prototype=t.prototype,n=new n,(e=t.apply(n,e))instanceof Object?e:n}function tt(e,t,n){switch(t){case 0:return n?function(e){return m[e]}:function(e){return v[e]};case 1:return n?function(e){return y[e>>1]}:function(e){return g[e>>1]};case 2:return n?function(e){return b[e>>2]}:function(e){return w[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}var nt={};function rt(e){var t=nt[e];return void 0===t?ye(e):t}var it=[];function at(e){return e||be("Cannot use deleted val. handle = "+e),Xe[e].value}function ot(){cn()}var st,ut,ct,lt=null,ft="",dt=0,ht=null,pt=0,mt=0,vt=0,yt=0,gt=[],bt={},wt=!1,Tt=!1,At=[];function xt(){function e(){Tt=document.pointerLockElement===t.canvas||document.mozPointerLockElement===t.canvas||document.webkitPointerLockElement===t.canvas||document.msPointerLockElement===t.canvas}if(t.preloadPlugins||(t.preloadPlugins=[]),!Ot){Ot=!0;try{Dt=!0}catch(e){Dt=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}It="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:Dt?null:console.log("warning: no BlobBuilder"),jt="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,t.mb||void 0!==jt||(console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),t.mb=!0),t.preloadPlugins.push({canHandle:function(e){return!t.mb&&/\.(jpg|jpeg|png|bmp)$/i.test(e)},handle:function(e,n,r,i){var a=null;if(Dt)try{(a=new Blob([e],{type:Rt(n)})).size!==e.length&&(a=new Blob([new Uint8Array(e).buffer],{type:Rt(n)}))}catch(e){!function(e){u||(u={}),u[e]||(u[e]=1,o(e))}("Blob constructor present but fails: "+e+"; falling back to blob builder")}a||((a=new It).append(new Uint8Array(e).buffer),a=a.getBlob());var s=jt.createObjectURL(a),c=new Image;c.onload=function(){d(c.complete,"Image "+n+" could not be decoded");var i=document.createElement("canvas");i.width=c.width,i.height=c.height,i.getContext("2d").drawImage(c,0,0),t.preloadedImages[n]=i,jt.revokeObjectURL(s),r&&r(e)},c.onerror=function(){console.log("Image "+s+" could not be decoded"),i&&i()},c.src=s}}),t.preloadPlugins.push({canHandle:function(e){return!t.Sb&&e.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(e,n,r,i){function a(i){s||(s=!0,t.preloadedAudios[n]=i,r&&r(e))}function o(){s||(s=!0,t.preloadedAudios[n]=new Audio,i&&i())}var s=!1;if(!Dt)return o();try{var u=new Blob([e],{type:Rt(n)})}catch(e){return o()}u=jt.createObjectURL(u);var c=new Audio;c.addEventListener("canplaythrough",function(){a(c)},!1),c.onerror=function(){if(!s){console.log("warning: browser could not fully decode audio "+n+", trying slower base64 approach");for(var t="",r=0,i=0,o=0;o<e.length;o++)for(r=r<<8|e[o],i+=8;6<=i;){var u=r>>i-6&63;i-=6,t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[u]}2==i?(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&r)<<4],t+="=="):4==i&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&r)<<2],t+="="),c.src="data:audio/x-"+n.substr(-3)+";base64,"+t,a(c)}},c.src=u,function(e){t.noExitRuntime=!0,setTimeout(function(){f||e()},1e4)}(function(){a(c)})}});var n=t.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||function(){},n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",e,!1),document.addEventListener("mozpointerlockchange",e,!1),document.addEventListener("webkitpointerlockchange",e,!1),document.addEventListener("mspointerlockchange",e,!1),t.elementPointerLock&&n.addEventListener("click",function(e){!Tt&&t.canvas.requestPointerLock&&(t.canvas.requestPointerLock(),e.preventDefault())},!1))}}var Ct=!1,_t=void 0,Et=void 0;function Lt(e,n,r){function i(){wt=!1;var e=a.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e?(a.exitFullscreen=Pt,_t&&a.requestPointerLock(),wt=!0,Et?("undefined"!=typeof SDL&&(b[SDL.screen>>2]=8388608|w[SDL.screen>>2]),kt(t.canvas),Ft()):kt(a)):(e.parentNode.insertBefore(a,e),e.parentNode.removeChild(e),Et?("undefined"!=typeof SDL&&(b[SDL.screen>>2]=-8388609&w[SDL.screen>>2]),kt(t.canvas),Ft()):kt(a)),t.onFullScreen&&t.onFullScreen(wt),t.onFullscreen&&t.onFullscreen(wt)}void 0===(_t=e)&&(_t=!0),void 0===(Et=n)&&(Et=!1);var a=t.canvas;Ct||(Ct=!0,document.addEventListener("fullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("MSFullscreenChange",i,!1));var o=document.createElement("div");a.parentNode.insertBefore(o,a),o.appendChild(a),o.requestFullscreen=o.requestFullscreen||o.mozRequestFullScreen||o.msRequestFullscreen||(o.webkitRequestFullscreen?function(){o.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}:null)||(o.webkitRequestFullScreen?function(){o.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),r?o.requestFullscreen({Vb:r}):o.requestFullscreen()}function St(e,t,n){o("Browser.requestFullScreen() is deprecated. Please call Browser.requestFullscreen instead."),St=function(e,t,n){Lt(e,t,n)},Lt(e,t,n)}function Pt(){return!!wt&&((document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||function(){}).apply(document,[]),!0)}var Bt=0;function Mt(e){if("function"==typeof requestAnimationFrame)requestAnimationFrame(e);else{var t=Date.now();if(0===Bt)Bt=t+1e3/60;else for(;t+2>=Bt;)Bt+=1e3/60;setTimeout(e,Math.max(Bt-t,0))}}function Rt(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]}var Ut=[];function Ft(){var e=t.canvas;Ut.forEach(function(t){t(e.width,e.height)})}function kt(e,n,r){n&&r?(e.Ib=n,e.yb=r):(n=e.Ib,r=e.yb);var i=n,a=r;if(t.forcedAspectRatio&&0<t.forcedAspectRatio&&(i/a<t.forcedAspectRatio?i=Math.round(a*t.forcedAspectRatio):a=Math.round(i/t.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&"undefined"!=typeof screen){var o=Math.min(screen.width/i,screen.height/a);i=Math.round(i*o),a=Math.round(a*o)}Et?(e.width!=i&&(e.width=i),e.height!=a&&(e.height=a),void 0!==e.style&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=n&&(e.width=n),e.height!=r&&(e.height=r),void 0!==e.style&&(i!=n||a!=r?(e.style.setProperty("width",i+"px","important"),e.style.setProperty("height",a+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))}var Ot,Dt,It,jt,Wt={},zt=0;function Nt(){return m.length}var Gt,Vt={};function qt(e,t){var n=Vt[e];if(n)t(null,n);else{try{var r=function(){if("undefined"!=typeof indexedDB)return indexedDB;var e=null;return"object"===("undefined"==typeof window?"undefined":E(window))&&(e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),d(e,"IDBStore used, but indexedDB not supported"),e}().open(e,22)}catch(e){return void t(e)}r.onupgradeneeded=function(e){var t=e.target.result;e=e.target.transaction,t.objectStoreNames.contains("FILE_DATA")?e.objectStore("FILE_DATA"):t.createObjectStore("FILE_DATA")},r.onsuccess=function(){n=r.result,Vt[e]=n,t(null,n)},r.onerror=function(e){t(this.error),e.preventDefault()}}}function Ht(e,t,n){qt(e,function(e,r){if(e)return n(e);(e=r.transaction(["FILE_DATA"],t)).onerror=function(e){n(this.error||"unknown error"),e.preventDefault()},e=e.objectStore("FILE_DATA"),n(null,e)})}L("GMT",v,18480,4),I.push(function(){var e=t._fflush;e&&e(0),K[1].length&&$(1,10),K[2].length&&$(2,10)}),de=t.InternalError=fe("InternalError");for(var Xt=Array(256),Jt=0;256>Jt;++Jt)Xt[Jt]=String.fromCharCode(Jt);function Yt(e){var t=Array(S(e)+1);return L(e,t,0,t.length),t}ve=Xt,ge=t.BindingError=fe("BindingError"),Be.prototype.isAliasOf=function(e){if(!(this instanceof Be&&e instanceof Be))return!1;var t=this.La.Oa.Na,n=this.La.Ma,r=e.La.Oa.Na;for(e=e.La.Ma;t.Sa;)n=t.$a(n),t=t.Sa;for(;r.Sa;)e=r.$a(e),r=r.Sa;return t===r&&n===e},Be.prototype.clone=function(){if(this.La.Ma||Ae(this),this.La.Za)return this.La.count.value+=1,this;var e=Ee(Object.create(Object.getPrototypeOf(this),{La:{value:Te(this.La)}}));return e.La.count.value+=1,e.La.Va=!1,e},Be.prototype.delete=function(){this.La.Ma||Ae(this),this.La.Va&&!this.La.Za&&be("Object already scheduled for deletion"),Ce(this),_e(this.La),this.La.Za||(this.La.Pa=void 0,this.La.Ma=void 0)},Be.prototype.isDeleted=function(){return!this.La.Ma},Be.prototype.deleteLater=function(){return this.La.Ma||Ae(this),this.La.Va&&!this.La.Za&&be("Object already scheduled for deletion"),Se.push(this),1===Se.length&&Le&&Le(Pe),this.La.Va=!0,this},We.prototype.ub=function(e){return this.nb&&(e=this.nb(e)),e},We.prototype.jb=function(e){this.Ua&&this.Ua(e)},We.prototype.argPackAdvance=8,We.prototype.readValueFromPointer=ae,We.prototype.deleteObject=function(e){null!==e&&e.delete()},We.prototype.fromWireType=function(e){function t(){return this.bb?je(this.Na.Ya,{Oa:this.Bb,Ma:n,Ra:this,Pa:e}):je(this.Na.Ya,{Oa:this,Ma:e})}var n=this.ub(e);if(!n)return this.jb(e),null;var r=function(e,t){for(void 0===t&&be("ptr should not be undefined");e.Sa;)t=e.$a(t),e=e.Sa;return Ie[t]}(this.Na,n);if(void 0!==r)return 0===r.La.count.value?(r.La.Ma=n,r.La.Pa=e,r.clone()):(r=r.clone(),this.jb(e),r);if(r=this.Na.tb(n),!(r=Me[r]))return t.call(this);r=this.ab?r.qb:r.pointerType;var i=function e(t,n,r){return n===r?t:void 0===r.Sa?null:null===(t=e(t,n,r.Sa))?null:r.rb(t)}(n,this.Na,r.Na);return null===i?t.call(this):this.bb?je(r.Na.Ya,{Oa:r,Ma:i,Ra:this,Pa:e}):je(r.Na.Ya,{Oa:r,Ma:i})},t.getInheritedInstanceCount=function(){return Object.keys(Ie).length},t.getLiveInheritedInstances=function(){var e,t=[];for(e in Ie)Ie.hasOwnProperty(e)&&t.push(Ie[e]);return t},t.flushPendingDeletes=Pe,t.setDelayFunction=function(e){Le=e,Se.length&&Le&&Le(Pe)},Ge=t.UnboundTypeError=fe("UnboundTypeError"),t.count_emval_handles=function(){for(var e=0,t=5;t<Xe.length;++t)void 0!==Xe[t]&&++e;return e},t.get_first_emval=function(){for(var e=5;e<Xe.length;++e)if(void 0!==Xe[e])return Xe[e];return null},t.requestFullScreen=function(e,n,r){o("Module.requestFullScreen is deprecated. Please call Module.requestFullscreen instead."),t.requestFullScreen=t.requestFullscreen,St(e,n,r)},t.requestFullscreen=function(e,t,n){Lt(e,t,n)},t.requestAnimationFrame=function(e){Mt(e)},t.setCanvasSize=function(e,n,r){kt(t.canvas,e,n),r||Ft()},t.pauseMainLoop=function(){lt=null,dt++},t.resumeMainLoop=function(){dt++;var e=mt,n=vt,r=ht;ht=null,function(e){var n=pt;t.noExitRuntime=!0,d(!ht,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),ht=e,pt=n;var r=void 0!==n?function(){t.dynCall_vi(e,n)}:function(){t.dynCall_v(e)},i=dt;ut=function(){if(!f)if(0<gt.length){var e=Date.now(),n=gt.shift();if(n.eb(n.Wa),ct){var a=ct,s=0==a%1?a-1:Math.floor(a);ct=n.Kb?s:(8*a+(s+.5))/9}console.log('main loop blocker "'+n.name+'" took '+(Date.now()-e)+" ms"),t.setStatus&&(e=t.statusMessage||"Please wait...",n=ct,a=bt.Ob,n?n<a?t.setStatus(e+" ("+(a-n)+"/"+a+")"):t.setStatus(e):t.setStatus("")),i<dt||setTimeout(ut,0)}else if(!(i<dt))if(yt=yt+1|0,1==mt&&1<vt&&0!=yt%vt)lt();else{0==mt&&(st=ot()),"timeout"===ft&&t.cb&&(o("Looks like you are rendering without using requestAnimationFrame for the main loop. You should use 0 for the frame rate in emscripten_set_main_loop in order to use requestAnimationFrame, as that can greatly improve your frame rates!"),ft="");e:if(!(f||t.preMainLoop&&!1===t.preMainLoop())){try{r()}catch(e){if(e instanceof sn)break e;throw e&&"object"===E(e)&&e.stack&&o("exception thrown: "+[e,e.stack]),e}t.postMainLoop&&t.postMainLoop()}i<dt||("object"===("undefined"==typeof SDL?"undefined":E(SDL))&&SDL.audio&&SDL.audio.Cb&&SDL.audio.Cb(),lt())}}}(r),function(e,t){if(mt=e,vt=t,ht)if(0==e)lt=function(){var e=0|Math.max(0,st+t-ot());setTimeout(ut,e)},ft="timeout";else if(1==e)lt=function(){Mt(ut)},ft="rAF";else if(2==e){if("undefined"==typeof setImmediate){var n=[];addEventListener("message",function(e){"setimmediate"!==e.data&&"setimmediate"!==e.data.target||(e.stopPropagation(),n.shift()())},!0),setImmediate=function(e){n.push(e),postMessage("setimmediate","*")}}lt=function(){setImmediate(ut)},ft="immediate"}}(e,n),lt()},t.getUserMedia=function(){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(void 0)},t.createContext=function(e,n,r,i){return function(e,n,r,i){if(n&&t.cb&&e==t.canvas)return t.cb;var a;if(n){var o={antialias:!1,alpha:!1,Qb:1};if(i)for(var s in i)o[s]=i[s];if("undefined"!=typeof GL&&(a=GL.Lb(e,o)))var u=GL.getContext(a).Jb}else u=e.getContext("2d");return u?(r&&(n||d("undefined"==typeof GLctx,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),t.cb=u,n&&GL.Rb(a),t.Ub=n,At.forEach(function(e){e()}),xt()),u):null}(e,n,r,i)},ot="undefined"!=typeof dateNow?dateNow:"object"===("undefined"==typeof performance?"undefined":E(performance))&&performance&&"function"==typeof performance.now?function(){return performance.now()}:Date.now;var Qt=t.asm({},{i:cn,A:function(){},da:function(){o("missing function: _ZN5Umbra18createDirRecursiveEPKc"),cn(-1)},_:function e(n){if(e.pb)var r=b[n>>2],i=b[r>>2];else e.pb=!0,Z.USER=Z.LOGNAME="web_user",Z.PATH="/",Z.PWD="/",Z.HOME="/home/web_user",Z.LANG="C.UTF-8",Z.LANG=("object"===("undefined"==typeof navigator?"undefined":E(navigator))&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",Z._=t.thisProgram,i=W?nn(1024):s(1024),r=W?nn(256):s(256),b[r>>2]=i,b[n>>2]=r;n=[];var a,o=0;for(a in Z)if("string"==typeof Z[a]){var u=a+"="+Z[a];n.push(u),o+=u.length}if(1024<o)throw Error("Environment size exceeded TOTAL_ENV_SIZE!");for(a=0;a<n.length;a++){o=u=n[a];for(var c=i,l=0;l<o.length;++l)m[c++>>0]=o.charCodeAt(l);m[c>>0]=0,b[r+4*a>>2]=i,i+=u.length+1}b[r+4*n.length>>2]=0},G:function(){return function(e,t){I.unshift({eb:e,Wa:t})}.apply(null,arguments)},X:function(){throw f=!0,"Pure virtual function called!"},w:function(){},z:function(e){return t.___errno_location&&(b[t.___errno_location()>>2]=e),e},N:function(e,t){ee=t;try{return ne.lb(),te(),te(),te(),te(),0}catch(e){return cn(e),-e.Xa}},M:function(e,t){ee=t;try{var n=ne.lb(),r=te(),i=te();return ne.Mb(n,r,i)}catch(e){return cn(e),-e.Xa}},y:function(e,t){ee=t;try{var n=te(),r=te(),i=te();for(t=e=0;t<i;t++){for(var a=b[r+8*t>>2],o=b[r+(8*t+4)>>2],s=0;s<o;s++)$(n,v[a+s]);e+=o}return e}catch(e){return cn(e),-e.Xa}},ca:function(e,t){ee=t;try{var n=_(te()),r=te();return ne.Nb((void 0).stat,n,r)}catch(e){return cn(e),-e.Xa}},v:function(e,t){return ee=t,0},ba:function(e,t){ee=t;try{var n=_(te()),r=te(),i=te();return(void 0).open(n,r,i).Pb}catch(e){return cn(e),-e.Xa}},L:function(e,t){return ee=t,0},K:function(e,t){ee=t;try{return ne.lb(),0}catch(e){return cn(e),-e.Xa}},x:function(){},u:function(e){var t=re[e];delete re[e];var n=t.gb,r=t.Ua,i=t.kb;pe([e],i.map(function(e){return e.xb}).concat(i.map(function(e){return e.Fb})),function(e){var a={};return i.forEach(function(t,n){var r=e[n],o=t.vb,s=t.wb,u=e[n+i.length],c=t.Eb,l=t.Gb;a[t.sb]={read:function(e){return r.fromWireType(o(s,e))},write:function(e,t){var n=[];c(l,e,u.toWireType(n,t)),ie(n)}}}),[{name:t.name,fromWireType:function(e){var t,n={};for(t in a)n[t]=a[t].read(e);return r(e),n},toWireType:function(e,t){for(var i in a)if(!(i in t))throw new TypeError("Missing field");var o=n();for(i in a)a[i].write(o,t[i]);return null!==e&&e.push(r,o),o},argPackAdvance:8,readValueFromPointer:ae,Qa:r}]})},aa:function(e,t,n,r,i){var a=me(n);we(e,{name:t=ye(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?r:i},argPackAdvance:8,readValueFromPointer:function(e){if(1===n)var r=m;else if(2===n)r=y;else{if(4!==n)throw new TypeError("Unknown boolean type size: "+t);r=b}return this.fromWireType(r[e>>a])},Qa:null})},J:function(e,t,n,r,i,a,o,s,u,c,l,f,d){l=ye(l),a=Ne(i,a),s&&(s=Ne(o,s)),c&&(c=Ne(u,c)),d=Ne(f,d);var h=ce(l);Re(h,function(){qe("Cannot construct "+l+" due to unbound types",[r])}),pe([e,t,n],r?[r]:[],function(t){if(t=t[0],r)var n=t.Na,i=n.Ya;else i=Be.prototype;t=le(h,function(){if(Object.getPrototypeOf(this)!==o)throw new ge("Use 'new' to construct "+l);if(void 0===u.ib)throw new ge(l+" has no accessible constructor");var e=u.ib[arguments.length];if(void 0===e)throw new ge("Tried to invoke ctor of "+l+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(u.ib).toString()+") parameters instead!");return e.apply(this,arguments)});var o=Object.create(i,{constructor:{value:t}});t.prototype=o;var u=new Ue(l,t,o,d,n,a,s,c);n=new We(l,u,!0,!1),i=new We(l+"*",u,!1,!1);var f=new We(l+" const*",u,!1,!0);return Me[e]={pointerType:i,qb:f},ze(h,t),[n,i,f]})},$:function(e,t){we(e,{name:t=ye(t),fromWireType:function(e){var t=Xe[e].value;return Je(e),t},toWireType:function(e,t){return Ye(t)},argPackAdvance:8,readValueFromPointer:ae,Qa:null})},t:function(e,t,n,r){function i(){}n=me(n),t=ye(t),i.values={},we(e,{name:t,constructor:i,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:Qe(t,n,r),Qa:null}),Re(t,i)},h:function(e,t,n){var r=Ze(e,"enum");t=ye(t),e=r.constructor,r=Object.create(r.constructor.prototype,{value:{value:n},constructor:{value:le(r.name+"_"+t,function(){})}}),e.values[n]=r,e[t]=r},I:function(e,t,n){n=me(n),we(e,{name:t=ye(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+Ke(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:$e(t,n),Qa:null})},d:function(e,t,n,r,i,a){var o=function(e,t){for(var n=[],r=0;r<e;r++)n.push(b[(t>>2)+r]);return n}(t,n);e=ye(e),i=Ne(r,i),Re(e,function(){qe("Cannot call "+e+" due to unbound types",o)},t-1),pe([],o,function(n){var r=e,o=e;n=[n[0],null].concat(n.slice(1));var s=i,u=n.length;2>u&&be("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var c=null!==n[1]&&!1,l=!1,f=1;f<n.length;++f)if(null!==n[f]&&void 0===n[f].Qa){l=!0;break}var d="void"!==n[0].name,h="",p="";for(f=0;f<u-2;++f)h+=(0!==f?", ":"")+"arg"+f,p+=(0!==f?", ":"")+"arg"+f+"Wired";o="return function "+ce(o)+"("+h+") {\nif (arguments.length !== "+(u-2)+") {\nthrowBindingError('function "+o+" called with ' + arguments.length + ' arguments, expected "+(u-2)+" args!');\n}\n",l&&(o+="var destructors = [];\n");var m=l?"destructors":"null";for(h="throwBindingError invoker fn runDestructors retType classParam".split(" "),s=[be,s,a,ie,n[0],n[1]],c&&(o+="var thisWired = classParam.toWireType("+m+", this);\n"),f=0;f<u-2;++f)o+="var arg"+f+"Wired = argType"+f+".toWireType("+m+", arg"+f+"); // "+n[f+2].name+"\n",h.push("argType"+f),s.push(n[f+2]);if(c&&(p="thisWired"+(0<p.length?", ":"")+p),o+=(d?"var rv = ":"")+"invoker(fn"+(0<p.length?", ":"")+p+");\n",l)o+="runDestructors(destructors);\n";else for(f=c?1:2;f<n.length;++f)u=1===f?"thisWired":"arg"+(f-2)+"Wired",null!==n[f].Qa&&(o+=u+"_dtor("+u+"); // "+n[f].name+"\n",h.push(u+"_dtor"),s.push(n[f].Qa));return d&&(o+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),h.push(o+"}\n"),ze(r,n=et(h).apply(null,s),t-1),[]})},o:function(e,t,n,r,i){function a(e){return e}t=ye(t),-1===i&&(i=4294967295);var o=me(n);if(0===r){var s=32-8*n;a=function(e){return e<<s>>>s}}var u=-1!=t.indexOf("unsigned");we(e,{name:t,fromWireType:a,toWireType:function(e,n){if("number"!=typeof n&&"boolean"!=typeof n)throw new TypeError('Cannot convert "'+Ke(n)+'" to '+this.name);if(n<r||n>i)throw new TypeError('Passing a number "'+Ke(n)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+r+", "+i+"]!");return u?n>>>0:0|n},argPackAdvance:8,readValueFromPointer:tt(t,o,0!==r),Qa:null})},m:function(e,t,n){function r(e){e>>=2;var t=w;return new i(t.buffer,t[e+1],t[e])}var i=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];we(e,{name:n=ye(n),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{zb:!0})},H:function(e,t){var n="std::string"===(t=ye(t));we(e,{name:t,fromWireType:function(e){var t=w[e>>2];if(n){var r=v[e+4+t],i=0;0!=r&&(i=r,v[e+4+t]=0);var a=e+4;for(r=0;r<=t;++r){var o=e+4+r;if(0==v[o]){if(a=_(a),void 0===s)var s=a;else s+=String.fromCharCode(0),s+=a;a=o+1}}0!=i&&(v[e+4+t]=i)}else{for(s=Array(t),r=0;r<t;++r)s[r]=String.fromCharCode(v[e+4+r]);s=s.join("")}return tn(e),s},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;r||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||be("Cannot pass non-string to std::string");var i=(n&&r?function(){return S(t)}:function(){return t.length})(),a=nn(4+i+1);if(w[a>>2]=i,n&&r)L(t,v,a+4,i+1);else if(r)for(r=0;r<i;++r){var o=t.charCodeAt(r);255<o&&(tn(a),be("String has UTF-16 code units that do not fit in 8 bits")),v[a+4+r]=o}else for(r=0;r<i;++r)v[a+4+r]=t[r];return null!==e&&e.push(tn,a),a},argPackAdvance:8,readValueFromPointer:ae,Qa:function(e){tn(e)}})},Z:function(e,t,n){if(n=ye(n),2===t)var r=function(){return g},i=1;else 4===t&&(r=function(){return w},i=2);we(e,{name:n,fromWireType:function(e){for(var t=r(),n=w[e>>2],a=Array(n),o=e+4>>i,s=0;s<n;++s)a[s]=String.fromCharCode(t[o+s]);return tn(e),a.join("")},toWireType:function(e,n){var a=r(),o=n.length,s=nn(4+o*t);w[s>>2]=o;for(var u=s+4>>i,c=0;c<o;++c)a[u+c]=n.charCodeAt(c);return null!==e&&e.push(tn,s),s},argPackAdvance:8,readValueFromPointer:ae,Qa:function(e){tn(e)}})},s:function(e,t,n,r,i,a){re[e]={name:ye(t),gb:Ne(n,r),Ua:Ne(i,a),kb:[]}},j:function(e,t,n,r,i,a,o,s,u,c){re[e].kb.push({sb:ye(t),xb:n,vb:Ne(r,i),wb:a,Fb:o,Eb:Ne(s,u),Gb:c})},Y:function(e,t){we(e,{Ab:!0,name:t=ye(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},q:function(e,t,n,r){(e=it[e])(t=at(t),n=rt(n),null,r)},c:Je,p:function(e,t){for(var n=(t=function(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=Ze(b[(t>>2)+r],"parameter "+r);return n}(e,t))[0],r=n.name+"_$"+t.slice(1).map(function(e){return e.name}).join("_")+"$",i=["retType"],a=[n],o="",s=0;s<e-1;++s)o+=(0!==s?", ":"")+"arg"+s,i.push("argType"+s),a.push(t[1+s]);r="return function "+ce("methodCaller_"+r)+"(handle, name, destructors, args) {\n";var u=0;for(s=0;s<e-1;++s)r+="    var arg"+s+" = argType"+s+".readValueFromPointer(args"+(u?"+"+u:"")+");\n",u+=t[s+1].argPackAdvance;for(r+="    var rv = handle[name]("+o+");\n",s=0;s<e-1;++s)t[s+1].deleteObject&&(r+="    argType"+s+".deleteObject(arg"+s+");\n");return n.Ab||(r+="    return retType.toWireType(destructors, rv);\n"),i.push(r+"};\n"),function(e){var t=it.length;return it.push(e),t}(e=et(i).apply(null,a))},F:function(e){4<e&&(Xe[e].hb+=1)},r:function(){return Ye([])},g:function(e){return Ye(rt(e))},n:function(){return Ye({})},e:function(e,t,n){e=at(e),t=at(t),n=at(n),e[t]=n},f:function(e,t){return Ye(e=(e=Ze(e,"_emval_take_value")).readValueFromPointer(t))},l:function(){t.abort()},E:function(e){return Q[e]()},W:function(e,t,n,r,i,a,o,s,u,c,l,f){return Q[e](t,n,r,i,a,o,s,u,c,l,f)},D:function(e){(e=Wt[e])&&e.abort()},V:Nt,k:ot,C:function(e,t,n,r,i){!function(e,t,n){Ht(e,"readonly",function(e,r){if(e)return n(e);(e=r.get(t)).onsuccess=function(e){return(e=e.target.result)?n(null,e):n("file "+t+" not found")},e.onerror=function(e){n(e)}})}(_(e),_(t),function(e,t){e?i&&an(i,n):(e=nn(t.length),v.set(t,e),on(r,n,e,t.length),tn(e))})},U:function(e,t,n,r,i,a,o){!function(e,t,n,r){Ht(e,"readwrite",function(e,i){if(e)return r(e);(e=i.put(n,t)).onsuccess=function(){r()},e.onerror=function(e){r(e)}})}(_(e),_(t),new Uint8Array(v.subarray(n,n+r)),function(e){e?o&&an(o,i):a&&an(a,i)})},T:function(e,t,n){v.set(v.subarray(t,t+n),e)},S:function(e){if(2147418112<e)return!1;for(var t=Math.max(Nt(),16777216);t<e;)t=536870912>=t?B(2*t):Math.min(B((3*t+2147483648)/4),2147418112);return!!function(e){e=B(e);var t=p.byteLength;try{return-1!==l.grow((e-t)/65536)&&(p=l.buffer,!0)}catch(e){return!1}}(t)&&(M(),!0)},R:function(e){!t.noExitRuntime&&(f=!0,F(I),t.onExit)&&t.onExit(e),t.quit(e,new sn(e))},B:function(){cn("trap!")},Q:function(e){!function(){function e(e){return(e=e.toTimeString().match(/\(([A-Za-z ]+)\)$/))?e[1]:"GMT"}if(!Gt){Gt=!0,b[$t()>>2]=60*(new Date).getTimezoneOffset();var t=new Date(2e3,0,1),n=new Date(2e3,6,1);b[Kt()>>2]=Number(t.getTimezoneOffset()!=n.getTimezoneOffset());var r=e(t),i=e(n);r=h(Yt(r)),i=h(Yt(i)),n.getTimezoneOffset()<t.getTimezoneOffset()?(b[en()>>2]=r,b[en()+4>>2]=i):(b[en()>>2]=i,b[en()+4>>2]=r)}}(),e=new Date(1e3*b[e>>2]),b[4608]=e.getSeconds(),b[4609]=e.getMinutes(),b[4610]=e.getHours(),b[4611]=e.getDate(),b[4612]=e.getMonth(),b[4613]=e.getFullYear()-1900,b[4614]=e.getDay();var t=new Date(e.getFullYear(),0,1);b[4615]=(e.getTime()-t.getTime())/864e5|0,b[4617]=-60*e.getTimezoneOffset();var n=new Date(2e3,6,1).getTimezoneOffset();return e=0|(n!=(t=t.getTimezoneOffset())&&e.getTimezoneOffset()==Math.min(t,n)),b[4616]=e,e=b[en()+(e?4:0)>>2],b[4618]=e,18432},P:function(e){var t=Date.now()/1e3|0;return e&&(b[e>>2]=t),t},O:function(){cn("OOM")},a:R,b:18416},p);t.asm=Qt,t.___embind_register_native_and_builtin_types=function(){return t.asm.ea.apply(null,arguments)};var Zt=t.___getTypeName=function(){return t.asm.fa.apply(null,arguments)},Kt=t.__get_daylight=function(){return t.asm.ga.apply(null,arguments)},$t=t.__get_timezone=function(){return t.asm.ha.apply(null,arguments)},en=t.__get_tzname=function(){return t.asm.ia.apply(null,arguments)},tn=t._free=function(){return t.asm.ja.apply(null,arguments)},nn=t._malloc=function(){return t.asm.ka.apply(null,arguments)},rn=t.globalCtors=function(){return t.asm.Ja.apply(null,arguments)};t.stackAlloc=function(){return t.asm.Ka.apply(null,arguments)},t.dynCall_i=function(){return t.asm.la.apply(null,arguments)},t.dynCall_ii=function(){return t.asm.ma.apply(null,arguments)},t.dynCall_iii=function(){return t.asm.na.apply(null,arguments)},t.dynCall_iiii=function(){return t.asm.oa.apply(null,arguments)},t.dynCall_iiiii=function(){return t.asm.pa.apply(null,arguments)},t.dynCall_iiiiii=function(){return t.asm.qa.apply(null,arguments)},t.dynCall_iiiiiifi=function(){return t.asm.ra.apply(null,arguments)},t.dynCall_iiiiiiiiii=function(){return t.asm.sa.apply(null,arguments)},t.dynCall_iiiji=function(){return t.asm.ta.apply(null,arguments)},t.dynCall_ji=function(){return t.asm.ua.apply(null,arguments)},t.dynCall_jiji=function(){return t.asm.va.apply(null,arguments)},t.dynCall_v=function(){return t.asm.wa.apply(null,arguments)};var an=t.dynCall_vi=function(){return t.asm.xa.apply(null,arguments)};t.dynCall_vii=function(){return t.asm.ya.apply(null,arguments)},t.dynCall_viifiii=function(){return t.asm.za.apply(null,arguments)};var on=t.dynCall_viii=function(){return t.asm.Aa.apply(null,arguments)};function sn(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function un(){function e(){if(!t.calledRun&&(t.calledRun=!0,!f)){if(W=!0,F(O),F(D),t.onRuntimeInitialized&&t.onRuntimeInitialized(),t.postRun)for("function"==typeof t.postRun&&(t.postRun=[t.postRun]);t.postRun.length;){var e=t.postRun.shift();j.unshift(e)}F(j)}}if(!(0<N)){if(t.preRun)for("function"==typeof t.preRun&&(t.preRun=[t.preRun]);t.preRun.length;)z();F(k),0<N||t.calledRun||(t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),e()},1)):e())}}function cn(e){throw t.onAbort&&t.onAbort(e),a(e),o(e),f=!0,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(t.dynCall_viiif=function(){return t.asm.Ba.apply(null,arguments)},t.dynCall_viiifi=function(){return t.asm.Ca.apply(null,arguments)},t.dynCall_viiifiii=function(){return t.asm.Da.apply(null,arguments)},t.dynCall_viiii=function(){return t.asm.Ea.apply(null,arguments)},t.dynCall_viiiii=function(){return t.asm.Fa.apply(null,arguments)},t.dynCall_viiiiii=function(){return t.asm.Ga.apply(null,arguments)},t.dynCall_viiiiiiiii=function(){return t.asm.Ha.apply(null,arguments)},t.dynCall_viij=function(){return t.asm.Ia.apply(null,arguments)},t.asm=Qt,t.then=function(e){if(t.calledRun)e(t);else{var n=t.onRuntimeInitialized;t.onRuntimeInitialized=function(){n&&n(),e(t)}}return t},sn.prototype=Error(),sn.prototype.constructor=sn,V=function e(){t.calledRun||un(),t.calledRun||(V=e)},t.run=un,t.abort=cn,t.preInit)for("function"==typeof t.preInit&&(t.preInit=[t.preInit]);0<t.preInit.length;)t.preInit.pop()();return un(),t.maxBytesDownloaded=0,t.minBytesDownloaded=0,t.URLsDownloaded=new Set([]),t.wgetRequests=Wt,e}),M={RGBA32:0,RGB24:1,BC1:2,BC3:3,BC4:4,BC5:5,ETC1_RGB:6,RGBA_FLOAT32:7,UNC1:8,JPEG:9,PNG:10,BMP:11,PSD:12,TGA:13,GIF:14,HDR:15,PIC:16,PNM:17,ASTC_4X4:18,ASTC_5X4:19,ASTC_5X5:20,ASTC_6X5:21,ASTC_6X6:22,ASTC_8X5:23,ASTC_8X6:24,ASTC_10X5:25,ASTC_10X6:26,ASTC_8X8:27,ASTC_10X8:28,ASTC_10X10:29,ASTC_12X10:30,ASTC_12X12:31,ARGB32:32,R8:33,PVRTC1_RGB4:34,PVRTC1_RGBA4:35,UINT8:36,UINT16:37,UINT32:38,RGB565:39,RG8:40,RG16F:41,COUNT:42},R=["rgba32","rgb24","bc1","bc3","bc4","bc5","etc1_rgb","rgba_float32","unc1","jpeg","png","bmp","psd","tga","gif","hdr","pic","pnm","astc_4x4","astc_5x4","astc_5x5","astc_6x5","astc_6x6","astc_8x5","astc_8x6","astc_10x5","astc_10x6","astc_8x8","astc_10x8","astc_10x10","astc_12x10","astc_12x12","argb32","r8","pvrtc1_rgb4","pvrtc1_rgba4","uint8","uint16","uint32","rgb565","rg8","rg16f","count"],U=["linear","srgb"],F=["diffuse","normal","legacy_unused","specular","meta_index"],k={None:0,BC1:1,BC2:2,BC3:4,BC4:8,BC5:16,BC6H:32,BC7:64,ASTC:128,ETC1:256,ETC2:512,EAC_R:1024,EAC_RG:2048,PVRTC1:4096,PVRTC2:8192,ATC:16384,HalfFloat:32768,All:-1},O=Object.freeze({TextureFormat:M,TextureFormatNames:R,ColorSpace:{LINEAR:0,SRGB:1},ColorSpaceNames:U,TextureType:{DIFFUSE:0,NORMAL:1,LEGACY_UNUSED:2,SPECULAR:3,META_INDEX:4,COUNT:5},TextureTypeNames:F,TextureCapability:k}),D=k,I=32,j=new Map([[Float32Array,"HEAPF32"],[Uint32Array,"HEAPU32"],[Uint16Array,"HEAPU16"],[Uint8Array,"HEAPU8"]]);function W(e){if(!Number.isInteger(e))throw new Error("Value was not integer: "+e.toString())}var z=function(e){class t{constructor(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Float32Array;if(this.ofs=void 0,this.size=void 0,this.type=void 0,W(t/n.BYTES_PER_ELEMENT),0===t)throw new Error("Buffer size was zero");if(this.ofs=e._malloc(t),0===this.ofs)throw new Error("Allocation of ".concat(t," bytes failed."));this.size=t,this.type=n}destroy(){e._free(this.ofs),this.ofs=0,this.size=0}ensureSize(t){if(this.size<t){if(this.destroy(),this.ofs=e._malloc(t),0===this.ofs)throw new Error("Buffer growth to ".concat(t," bytes failed."));this.size=t}}floats(){return new Float32Array(e.HEAPF32.buffer,this.ofs,this.size/4)}bytes(){return new Uint8Array(e.HEAPU8.buffer,this.ofs,this.size)}}class n{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.size,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.type;this.ofs=void 0,this.start=void 0,this.size=void 0,this.type=void 0,this.heapName=void 0,this.ofs=e.ofs,this.start=t,this.size=n,this.type=r,this.heapName=j.get(r)}getArray(){return new this.type(e[this.heapName].buffer,this.ofs+this.start,this.size/this.type.BYTES_PER_ELEMENT)}}var r=e.getRenderableSize(),i=e.getRenderableFields(),a=new t(24);function o(e,t){for(var n=0;n<16;n++)e[n]=t[n]}class s{constructor(){this.ptr=void 0,this.ptr=e.clientCreate()}destroy(){e.clientDestroy(this.ptr),this.ptr=0}}class u{constructor(n){this.ptr=void 0,this.creds=void 0,this.matrixBuffer=void 0,this.ptr=n,this.creds=e.sceneCredsCreate(),this.matrixBuffer=new t(64)}destroy(){e.sceneCredsDestroy(this.creds),this.matrixBuffer.destroy()}connect(t,n,r){if("string"!=typeof t)throw new TypeError("token should be a string");if("string"!=typeof n)throw new TypeError("projectID should be a string");if("string"!=typeof r)throw new TypeError("modelID should be a string");e.sceneConnect(this.ptr,this.creds,t,n,r)}connectToCustomAPI(t,n,r,i){if("string"!=typeof t)throw new TypeError("token should be a string");if("string"!=typeof n)throw new TypeError("projectID should be a string");if("string"!=typeof r)throw new TypeError("modelID should be a string");if("string"!=typeof i)throw new TypeError("apiURL should be a string");if(-1!==t.indexOf("#"))throw new Error('Use the "apiURL" argument instead of a magic token.');i.length>0&&"/"!==i[i.length-1]&&(i+="/");var a="".concat(i,"#token");e.sceneConnect(this.ptr,this.creds,a,n,r)}connectWithURL(t){if("string"!=typeof t)throw new TypeError("URL should be a string");if(0!==t.indexOf("http:")&&0!==t.indexOf("https:"))throw new Error("Should be an HTTP or HTTPS URL");e.sceneConnectWithURL(this.ptr,this.creds,t)}connectionStatus(){return e.sceneGetConnectionStatus(this.ptr)}getInfo(){return e.sceneGetInfo(this.ptr)}isConnected(){return this.connectionStatus()===e.ConnectionStatus.Connected}update(t){if(!Array.isArray(t))throw new TypeError("Matrix should be an array");if(16!==t.length)throw new TypeError("Matrix should be of size 4x4");o(this.matrixBuffer.floats(),t),e.sceneUpdate(this.ptr,this.matrixBuffer.ofs)}}class c{constructor(e,n){this.ptr=void 0,this.matrixBuffer=void 0,this.vectorBuffer=void 0,this.lightBuffer=void 0,this.temp=void 0,this.runtimeAssets=void 0,this.ptr=e,this.matrixBuffer=new t(64),this.vectorBuffer=new t(16),this.lightBuffer=new t(3*I*4),this.temp=void 0,this.runtimeAssets=n}destroy(){this.matrixBuffer.destroy(),this.vectorBuffer.destroy(),this.lightBuffer.destroy(),this.temp&&this.temp.destroy()}update(t,n,r){var i,a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!Array.isArray(t))throw new TypeError("Camera matrix should be an array");if(!Array.isArray(n))throw new TypeError("Position should be an array");if("number"!=typeof r)throw new TypeError("Quality should be a number");if(16!==t.length)throw new TypeError("Camera matrix should be of size 4x4");if(3!==n.length)throw new TypeError("Position vector should be of length 3");if(o(this.matrixBuffer.floats(),t),i=this.vectorBuffer.floats(),a=n,i[0]=a[0],i[1]=a[1],i[2]=a[2],s){if(s.length>I)throw new Error("Too many lights given");for(var u=this.lightBuffer.floats(),c=0;c<s.length;c++)u[3*c+0]=s[c][0],u[3*c+1]=s[c][1],u[3*c+2]=s[c][2]}e.viewUpdate(this.ptr,this.matrixBuffer.ofs,r,this.vectorBuffer.ofs,this.lightBuffer.ofs,s.length)}getVisible(n){W(n);var a=n*r;(!this.temp||this.temp.size<a)&&(this.temp&&this.temp.destroy(),this.temp=new t(a));var o=this.temp,s=r/4,u=a/4,c=i;W(s),W(u);for(var l=function(e,t,n,r){return W(r/4),new e(t.buffer,n+r,u-r/4)},f=l(Uint32Array,e.HEAPU32,o.ofs,c.mesh),d=l(Int32Array,e.HEAP32,o.ofs,c.lodLevel),h=l(Uint32Array,e.HEAPU32,o.ofs,c.visibilityMask),p=e.viewNextRenderables(this.ptr,o.ofs,n),m=[],v=0;v<p;v++){var y=f[s*v],g=d[s*v],b=h[s*v];m.push({id:y,mesh:this.runtimeAssets.get(y),lod:g,mask:b})}return m}}var l=new Map([[e.JobType.StreamIn,"Create"],[e.JobType.StreamOut,"Destroy"]]),f=new Map([[e.AssetType.Material,"Material"],[e.AssetType.Texture,"Texture"],[e.AssetType.Mesh,"Mesh"]]);class d{constructor(t){this.ptr=void 0,this.jobType=void 0,this.assetType=void 0,this.type=void 0,this.data=void 0,this.ptr=t,this.jobType=l.get(e.jobGetJobType(t)),this.assetType=f.get(e.jobGetAssetType(t)),this.type=this.jobType+this.assetType,this.data={}}finish(t,n){e.jobFinish(this.ptr,t,n)}success(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e.jobFinish(this.ptr,e.JobResult.Success,t)}fail(){e.jobFinish(this.ptr,e.JobResult.Failure,0)}get userPointer(){return e.jobGetUserPointer(this.ptr)}}var h=new Map([["position",new t(4)],["normal",new t(4)],["uv",new t(4)],["tangent",new t(4)],["index",new t(4)]]);function p(e,n,r){var i=h.get(e);return i.size<n?(i.size>0&&i.destroy(),i=new t(n,r),h.set(e,i)):r&&(i.type=r),i}class m{constructor(e,t){this.ownerJob=void 0,this.vertexBuffers=void 0,this.ptr=void 0,this.ptr=e,this.ownerJob=t}setBuffers(t){if(!e.meshLoaderSetBuffers(this.ptr,t))throw console.log(t),new Error("setBuffers failed")}loadNext(){return e.meshLoaderLoadNext(this.ptr)}done(){return e.meshLoaderDone(this.ptr)}allocateBuffers(){var t=e.meshLoaderGetAttributes(this.ptr),r=this.uniqueVertexCount,i=e.getEmptyMeshBufferDesc(),a={},o={};Object.keys(t).forEach(function(e){var n=r*t[e].elemSize;W(n/Float32Array.BYTES_PER_ELEMENT),o[e]=n}),Object.keys(t).forEach(function(e){var n=p(e,o[e],Float32Array),s=i[e];a[e]=n,s.ptr=n.ofs,s.elemSize=t[e].elemSize,s.size=r,s.stride=s.elemSize,s.flags=0});var s=this.indexCount,u=r<65536?2:4;if(0===s)throw new Error("Mesh index count was zero!");var c=s*u,l=p("index",c,2===u?Uint16Array:Uint32Array),f={};f.elemSize=u,f.ptr=l.ofs,f.size=s,f.stride=f.elemSize,f.flags=0,a.index=l,o.index=c,i.index=f;var d={};return Object.keys(a).forEach(function(e){d[e]=new n(a[e],0,o[e])}),{buffers:d,desc:i}}get uniqueVertexCount(){return e.meshLoaderUniqueVertexCount(this.ptr)}get indexCount(){return e.meshLoaderIndexCount(this.ptr)}get attributes(){return e.meshLoaderGetAttributes(this.ptr)}get material(){return e.meshLoaderGetMaterial(this.ptr)}get bounds(){e.meshLoaderGetBounds(this.ptr,a.ofs);var t=a.floats();return[[t[0],t[1],t[2]],[t[3],t[4],t[5]]]}}class v{constructor(n,r){this.assets=void 0,this.client=void 0,this.ptr=void 0,this.platformFeatures=void 0,this.nextId=void 0,this.loader=void 0,this.tempTextureBuffer=void 0,this.tempTranscodedBuffer=void 0,this.debug=void 0;var i=D.ETC1|D.ASTC|D.PVRTC1|D.BC5,a=r.capabilityMask;a&i||(a|=D.BC5|D.BC4),this.client=n,this.ptr=e.runtimeCreate(n.ptr,a),this.platformFeatures=r,this.assets=new Map,this.nextId=1,this.loader=void 0,this.tempTextureBuffer=new t(1048576,Uint8Array),this.tempTranscodedBuffer=new t(4,Uint8Array),this.debug={textureFormatsInUse:new Set,platformFeatures:r}}destroy(){this.tempTextureBuffer.destroy(),this.tempTranscodedBuffer.destroy(),e.runtimeDestroy(this.ptr),this.client.destroy(),this.ptr=0}createScene(){var t=e.runtimeCreateScene(this.ptr);return new u(t)}destroyScene(t){e.runtimeDestroyScene(this.ptr,t.ptr)}createView(){var t=e.runtimeCreateView(this.ptr);return new c(t,this.assets)}destroyView(t){e.runtimeDestroyView(this.ptr,t.ptr)}update(){e.runtimeUpdate(this.ptr)}*getJobs(){for(var t=this;;){if(this.loader){if(!this.loader.done()){if(!this.loader.loadNext())throw new Error("loadNext failed");yield;continue}var r=this.loader.ownerJob;r.data.buffers=this.loader.vertexBuffers.buffers,r.data.desc=this.loader.vertexBuffers.desc,r.data.material=this.assets.get(this.loader.material),r.data.bounds=this.loader.bounds,this.loader=void 0,yield r}var i=e.runtimeGetJob(this.ptr);if(0===i)return;var a=new d(i);if("CreateMaterial"===a.type)a.data=e.jobGetMaterialData(a.ptr),a.data.textures=a.data.textures.map(function(e){return t.assets.get(e)}),yield a;else if("CreateTexture"===a.type){var o=e.jobGetTextureData(a.ptr),s=this.tempTextureBuffer;if(s.ensureSize(o.dataByteSize),!e.jobCopyTextureContents(a.ptr,s.ofs,s.size,!1)){a.fail();var u="Texture copying failed! Job pointer: "+a.ptr+", buffer ofs: "+s.ofs+", buffer size: "+s.size;throw new Error(u)}var c=new n(s,0,o.dataByteSize);if(this.formatNeedsTranscoding(o.format)){var l;o=this.downsampleAndTranscodeTexture(o,s,this.tempTranscodedBuffer);var f=(L(l={},M.RGBA32,Uint8Array),L(l,M.RGB565,Uint16Array),L(l,M.RG8,Uint8Array),L(l,M.RG16F,Uint16Array),l);(c=new n(this.tempTranscodedBuffer,0,o.dataByteSize)).type=f[o.format]}o.format=R[o.format],o.colorSpace=U[o.colorSpace],o.textureType=F[o.textureType],this.debug.textureFormatsInUse.add(o.format),a.data={info:o,buffer:c},yield a}else if("CreateMesh"===a.type)this.loader=new m(e.jobGetMeshLoader(a.ptr),a),this.loader.vertexBuffers=this.loader.allocateBuffers(),this.loader.setBuffers(this.loader.vertexBuffers.desc),yield;else{if("Destroy"!==a.jobType)throw new Error("Job wasn't handled correctly");a.data=this.assets.get(a.userPointer),yield a}}}handleJobs(e,t){var n=performance.now();for(var r of this.getJobs()){if(r)try{e[r.type](r)}catch(e){throw r.fail(),e}if(performance.now()-n>t)break}}addAsset(t,n){var r=this.nextId;this.nextId=this.nextId+1|0,0===this.nextId&&(this.nextId=1),this.assets.set(r,n),t.finish(e.JobResult.Success,r)}removeAsset(t,n){var r=t.userPointer;this.assets.has(r)&&this.assets.delete(r),t.finish(e.JobResult.Success,0)}failJob(t){t.finish(e.JobResult.Failure,0)}formatNeedsTranscoding(e){var t=this.platformFeatures.capabilityMask;switch(e){case M.BC1:if(t&k.BC1)return!1;break;case M.BC3:if(t&k.BC3)return!1;break;case M.BC4:if(t&k.BC4)return!1;break;case M.BC5:if(t&k.BC5)return!1;break;default:return!1}return!0}downsampleAndTranscodeTexture(t,n,r){var i=e.getUncompressedFromBCFormat(t.format);if(i===M.COUNT)throw new Error("Couldn't find a matching BC format");i!==M.RG16F||this.platformFeatures.halfFloat||(i=M.RG8);var a=e.getTextureByteSize(t.width,t.height,i);r.ensureSize(a);var o=e.downsampleAndTranscodeTexture(t.format,i,t.width,t.height,n.ofs,t.dataByteSize,r.ofs,r.size);if(!o.success)throw new Error("Texture transcoding failed. Input: ".concat(t.format,", output: ").concat(i,", output size: ").concat(a));if(o.texture.format!==i)throw new Error("Transcoded texture format was ".concat(o.texture.format," instead of the expected ").concat(i));var s=Object.assign({},t),u=o.texture;return s=Object.assign(s,{format:u.format,width:u.width,height:u.height,dataByteSize:u.dataByteSize,mipByteSizes:[u.dataByteSize]})}getDebugInfo(){return e.runtimeGetDebugInfo(this.ptr)}}return{createRuntime:function(e){return new v(new s,e)}}};function N(e){var t={};t.getProjects=function(t){var n=e.parseCloudCredentials(t);if(""===n.key)throw new Error("Couldn't parse token "+t);return function(e,t,n){var r=function(e,t){var n=e.url;return"/"!==n.substr(-1)&&(n+="/"),n+="api/v2",n+=t}(e,t),i=Object.assign({method:"GET",headers:{"Umbra-Client":"UmbraJS",Authorization:"Basic "+btoa(e.key+":")},mode:"cors"},n);return fetch(r,i).then(function(e){if(!e.ok)throw new Error("HTTP error, status = "+e.status);return e.json()})}(n,"/projects",{})},t.getPlatformFeatures=function(e){var t=0,n=new Set,r=!1,i=!1,a=new Map([]),o=[],s=e.getSupportedExtensions();for(var u of s){var c=u.replace(/^(.*)_WEBGL_/,"WEBGL_");a.set(c,u),o.push(c)}var l=new Map([["WEBGL_compressed_texture_s3tc",{mask:k.BC1|k.BC2|k.BC3,names:["bc1","bc2","bc3"]}],["WEBGL_compressed_texture_s3tc_srgb",{mask:k.BC1|k.BC2|k.BC3,names:["bc1","bc2","bc3"]}],["WEBGL_compressed_texture_rgtc",{mask:k.BC4|k.BC5,names:["bc4","bc5"]}],["WEBGL_compressed_texture_pvrtc",{mask:k.PVRTC1,names:["pvrtc1_rgb4","pvrtc1_rgba4"]}],["WEBGL_compressed_texture_etc1",{mask:k.ETC1,names:["etc1_rgb"]}],["WEBGL_compressed_texture_astc",{mask:k.ASTC,names:["astc_4x4"]}]]);for(var f of l.keys())if(o.includes(f)){e.getExtension(a.get(f));var d=l.get(f);t|=d.mask,d.names.forEach(function(e){return n.add(e)})}return o.includes("WEBGL_compressed_texture_s3tc_srgb")&&(r=!0),o.includes("EXT_sRGB")&&(e.getExtension(a.get("EXT_sRGB")),r=!0),o.includes("OES_texture_half_float")&&(e.getExtension(a.get("OES_texture_half_float")),i=!0),{capabilityMask:t,formats:S(n),srgb:r,halfFloat:i}},t.getIDs=function(e){if("projectID"in e&&"modelID"in e)return Promise.resolve({project:e.projectID,model:e.modelID});if("project"in e&&"model"in e){var n=e.token,r=e.project;e.model;return t.getProjects(n).then(function(e){var t=e.find(function(e){return e.name===r}),n=t.models.find(function(e){return e.name===n});if(!t){var i=e.map(function(e){return e.name});throw new Error("Couldn't find a project with name \""+r+'". Only found the following: '+i)}if(!n){var a=t.models.map(function(e){return e.name});throw new Error("Couldn't find a model with name \""+n+'". Only found the following: '+a)}return{project:t.id,model:n.id}})}throw new Error('Invalid project & model ID combination.\nYou should define either both "projectID" and "modelID" or "project" and "model"')},t.nativeModule=e;var n=z(e);return t.createRuntime=n.createRuntime,t.getStreamingInfo=function(){return{minBytesDownloaded:t.nativeModule.minBytesDownloaded,maxBytesDownloaded:t.nativeModule.maxBytesDownloaded}},t}var G=function(e){return e=Object.assign({wasmURL:""},e),new Promise(function(t,n){try{B({locateFile:function(t,n){return t.endsWith("umbra.wasm")&&""!==e.wasmURL?e.wasmURL:n+t}}).then(function(e){delete e.then,e.onAbort=function(e){n(e)},t(N(e))})}catch(e){n(e)}})},V=function(e){Object.values(e.nativeModule.wgetRequests).forEach(function(e){e.abort()});try{e.nativeModule.systemExit()}catch(e){if("ExitStatus"!==e.name)throw e}};function q(e,t,n){return{format:e,type:t,compressed:n}}var H={rgb24:q(r,e,!1),rgba32:q(t,e,!1),rgb565:q(r,n,!1),rg8:q(i,e,!1),rg16f:q(i,a,!1),bc1:q(o,e,!0),bc3:q(s,e,!0),etc1_rgb:q(u,e,!0),astc_4x4:q(c,e,!0),pvrtc1_rgb4:q(l,e,!0)};function X(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var J="\n#ifdef USE_NORMALMAP\n#ifdef USE_TANGENT\n\nvec3 tangentToWorld2 = normal;\nvec3 tangentToWorld0 = normalize(tangent - tangentToWorld2 * dot(tangentToWorld2, tangent));\n\n#ifdef UMBRA_FLIP_TANGENT\nvec3 tangentToWorld1 = normalize(cross(tangentToWorld0, tangentToWorld2));\n#else\nvec3 tangentToWorld1 = normalize(cross(tangentToWorld2, tangentToWorld0));\n#endif\n\n#if defined(UMBRA_TEXTURE_SUPPORT_BC5) || defined(UMBRA_TEXTURE_SUPPORT_ASTC)\nnormal.xy = texture2D(normalMap, vUv).xy * 2.0 - 1.0;\nnormal.z = sqrt(1.0 - clamp(dot(normal.xy, normal.xy), 0.0, 1.0));\n#elif defined(UMBRA_TEXTURE_SUPPORT_BC3)\nnormal.xy = texture2D(normalMap, vUv).yw * 2.0 - 1.0;\nnormal.z = sqrt(1.0 - clamp(dot(normal.xy, normal.xy), 0.0, 1.0));\n#else\nnormal.xyz = texture2D(normalMap, vUv).xyz;\nnormal.xy *= 2.0;\nnormal.xy -= 1.0;\nnormal = normalize(normal);\n#endif\n\nnormal = tangentToWorld0 * normal.x + tangentToWorld1 * normal.y + tangentToWorld2 * normal.z;\nnormal = normalize(normal);\n#endif\n#endif\n\n",Y="\nfloat metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\nvec4 texelMetalness = texture2D( metalnessMap, vUv );\nmetalnessFactor *= texelMetalness.r;\n#endif\n",Q="\nfloat roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\nvec4 texelRoughness = texture2D( roughnessMap, vUv );\nfloat roughness = 1.0 - texelRoughness.g;\nroughnessFactor *= roughness;\n#endif\n";class Z{constructor(e){this.flipTangent=void 0,this.defines=void 0,this.flipTangent=!1,this.defines="",e.indexOf("bc3")>-1&&(this.defines+="#define UMBRA_TEXTURE_SUPPORT_BC3\n"),e.indexOf("bc5")>-1&&(this.defines+="#define UMBRA_TEXTURE_SUPPORT_BC5\n"),e.indexOf("astc_4x4")>-1&&(this.defines+="#define UMBRA_TEXTURE_SUPPORT_ASTC\n")}process(e,t){var n=e.fragmentShader;this.flipTangent&&(n="#define UMBRA_FLIP_TANGENT\n"+n),n=(n=(n=(n=this.defines+n).replace("#include <normal_fragment_maps>",J)).replace("#include <metalnessmap_fragment>",Y)).replace("#include <roughnessmap_fragment>",Q),e.fragmentShader=n}}class K{constructor(){this.usedList=void 0,this.freeList=void 0,this.usedList=[],this.freeList=[]}allocate(e){var t;return t=this.freeList.length>0?this.freeList.pop():e(),this.usedList.push(t),t}freeAll(e){for(var t=0;t<this.usedList.length;t++)e&&e(this.usedList[t]),this.freeList.push(this.usedList[t]);this.usedList.length=0}clear(){this.usedList.length=0,this.freeList.length=0}}class $ extends f{constructor(e,t,n,r){super(),this.quality=.5,this.opaqueMaterial=new d,this.wireframe=!1,this.freeze=!1,this.isLOD=!0,this.autoUpdate=!0,this.name="UmbraModel",this.renderer=void 0,this.materialPool=new K,this.cameraToView=new Map,this.viewLastUsed=new Map,this.shaderPatcher=void 0,this.stats={numVisible:0,numShadowCasters:0,numCachedMaterials:0,numAssets:0},this.umbra=void 0,this.matrixWorldInverse=new h,this.projScreenMatrix=new h,this.cameraWorldPosition=new p,this.tempVector=new p,this.dirVector=new p,this.update=function(e){var t,n=this;if(!this.freeze)if(this.traverseAncestors(function(e){e.isScene&&(t=e)}),t||t.isScene){var r=[];this.renderer.shadowMap.enabled&&(r=function(e){var t=[];return e.traverseVisible(function(e){e.isDirectionalLight&&e.castShadow&&t.push(e)}),t}(t));var i=this.cameraToView.get(e);i||(i=this.umbra.runtime.createView(),this.cameraToView.set(e,i));var a=this.renderer.info.render.frame;if(this.viewLastUsed.set(i,a),this.pruneOldViews(a),this.umbra.scene.update(this.matrixWorld.elements),void 0!==this.opaqueMaterial.normalMapType){var o=this.matrixWorld.determinant()<0;o!==this.shaderPatcher.flipTangent&&(this.shaderPatcher.flipTangent=o,this.materialPool.clear())}this.matrixWorldInverse.getInverse(e.matrixWorld),this.projScreenMatrix.multiplyMatrices(e.projectionMatrix,this.matrixWorldInverse);var s=this.dirVector,u=this.tempVector,c=r.map(function(e){return s.setFromMatrixPosition(e.target.matrixWorld),u.setFromMatrixPosition(e.matrixWorld),s.sub(u),[s.x,s.y,s.z]},r);e.umbraStreamingPosition?this.cameraWorldPosition.copy(e.umbraStreamingPosition):e.getWorldPosition(this.cameraWorldPosition);var l=this.cameraWorldPosition;i.update(this.projScreenMatrix.elements,[l.x,l.y,l.z],this.quality,c),this.stats.numVisible=0,this.stats.numAssets=this.umbra.runtime.assets.size;for(var d=[],h=0;h<this.children.length;h++)this.children[h].isUmbraMesh||d.push(this.children[h]);this.children=d;var p=[],m=new f;m.isLOD=!0,m.autoUpdate=!0,m.update=function(e){n.children.pop();for(var t=0;t<p.length;t++)n.children.push(p[t])},this.materialPool.freeAll(function(e){delete e.map,delete e.normalMap,delete e.metalnessMap,delete e.roughnessMap});var g=[];do{g=i.getVisible(200);for(var b=function(e){var t=g[e].mesh,r=t.materialDesc,i=t.geometry,a=n.materialPool.allocate(function(){return n.opaqueMaterial.clone()});a.wireframe=n.wireframe,a.transparent=r.transparent,a.onBeforeCompile=function(e,t){n.opaqueMaterial.onBeforeCompile&&n.opaqueMaterial.onBeforeCompile.apply(a,[e,t]),n.shaderPatcher.process(e,t)};var o=r.textures[O.TextureType.DIFFUSE],s=r.textures[O.TextureType.NORMAL],u=r.textures[O.TextureType.SPECULAR];o&&o.isTexture&&(a.map=o),s&&s.isTexture&&(a.normalMap=s,a.vertexTangents=!0,a.normalMapType=v),u&&u.isTexture&&(a.metalnessMap=u,a.metalness=1,a.roughnessMap=u,a.roughness=1);var c=new y(i,a);c.isUmbraMesh=!0,c.matrixWorld.copy(n.matrixWorld),c.castShadow=n.castShadow,c.receiveShadow=n.receiveShadow,c.visible=!0,n.children.push(c),0==(1&g[e].mask)?(p.push(c),c.frustumCulled=!0):(n.children.push(c),c.frustumCulled=!1)},w=0;w<g.length;w++)b(w);this.stats.numVisible+=g.length}while(200===g.length);this.stats.numShadowCasters=p.length,this.stats.numCachedMaterials=this.materialPool.usedList.length+this.materialPool.freeList.length,p.length>0&&this.children.push(m)}else console.log("No parent scene found")},this.renderer=n,this.shaderPatcher=new Z(r.formats),this.scale.set(1,1,-1),this.umbra={runtime:e,scene:t}}getInfo(){var e={connected:this.umbra.scene.isConnected()};return e.connected&&(e.sceneInfo=this.umbra.scene.getInfo()),Object.assign(e,this.stats),e}getBounds(){if(this.umbra.scene.isConnected()){var e=this.umbra.scene.getInfo().bounds,t=e.min,n=e.max;return new m(new p(t[0],t[1],t[2]),new p(n[0],n[1],n[2]))}}getCenter(){var e=this.getBounds();e.applyMatrix4(this.matrixWorld);var t=new p;return e.getCenter(t),t}pruneOldViews(e){for(var t of this.viewLastUsed){var n=X(t,2),r=n[0];if(e-n[1]>1e3){for(var i of this.cameraToView){var a=X(i,2),o=a[0];if(a[1]===r){this.cameraToView.delete(o);break}}this.umbra.runtime.destroyView(r),this.viewLastUsed.delete(r)}}}dispose(){for(var e of this.cameraToView.values())this.umbra.runtime.destroyView(e);this.children=this.children.filter(function(e){return!e.isUmbraMesh}),this.materialPool.freeAll(function(e){return e.dispose()}),this.umbra.runtime.destroyScene(this.umbra.scene)}}function ee(e,t){if(!e)throw new TypeError('"renderer" should be of type THREE.WebGLRenderer');return G(t).then(function(t){var n;n="getContext"in e?e.getContext():e.context;var r=t.getPlatformFeatures(n);r.capabilityMask&=~O.TextureCapability.BC5;var i=t.createRuntime(r);return{createModel:function(n){var a=i.createScene();return new Promise(function(o,s){try{if(!("url"in n)){if("token"in n)return t.getIDs(n).then(function(t){"apiURL"in n?a.connectToCustomAPI(n.token,t.project,t.model,n.apiURL):a.connect(n.token,t.project,t.model),o(new $(i,a,e,r))},function(){var e=n;throw new Error("Couldn't fetch IDs matching arguments ".concat(e.project," and ").concat(e.model))});throw new Error("Invalid connection arguments")}a.connectWithURL(n.url),o(new $(i,a,e,r))}catch(e){i.destroyScene(a),s(e)}})},getStats:function(){return{maxBytesDownloaded:t.nativeModule.maxBytesDownloaded,minBytesDownloaded:t.nativeModule.minBytesDownloaded}},update:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n={CreateMaterial:function(e){i.addAsset(e,e.data)},DestroyMaterial:function(e){i.removeAsset(e,e.data)},CreateTexture:function(t){var n,r=t.data.info,a=t.data.buffer;if(H.hasOwnProperty(r.format)&&(n=H[r.format]),!n)return console.log("Unknown texture format",r.format),void i.addAsset(t,{isTexture:!1});var o,s=new a.type(a.getArray().slice());if(n.compressed){var u={width:r.width,height:r.height,data:s};o=new g([u],r.width,r.height)}else o=new b(s,r.width,r.height);o.format=n.format,o.type=n.type,o.magFilter=w,o.minFilter=w,o.anisotropy=0,"diffuse"!==r.textureType||e.gammaOutput?o.encoding="linear"===r.colorSpace?T:A:o.encoding=T,o.needsUpdate=!0,i.addAsset(t,o)},DestroyTexture:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){e.data.isTexture&&e.data.dispose(),i.removeAsset(e,e.data)}),CreateMesh:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t,n,r,a,o,s=new x,u=e.data.buffers.index.getArray(),c=Array.from(u);s.setIndex(c),s.boundingSphere=(t=e.data.bounds,n=t[0],r=t[1],a=new p(r[0]-n[0],r[1]-n[1],r[2]-n[2]),o=new p(n[0]+.5*a.x,n[1]+.5*a.y,n[2]+.5*a.z),new C(o,a.length()));var l={position:{components:3},normal:{components:3},uv:{components:2},tangent:{components:3}};Object.keys(l).forEach(function(t){var n=e.data.buffers[t];if(n){var r=n.getArray(),i=new _(r.slice(),l[t].components);s.addAttribute(t,i)}});var f={geometry:s,materialDesc:e.data.material};i.addAsset(e,f)}),DestroyMesh:function(e){var t=e.data;i.removeAsset(e,t),t.geometry.dispose()}};i.handleJobs(n,t),i.update()},dispose:function(){i.assets.forEach(function(e,t){"geometry"in e&&e.geometry.dispose(),"dispose"in e&&e.dispose()}),i.destroy(),i=void 0,V(t)},lib:t,runtime:i}})}export{$ as Model,ee as initWithThreeJS};
//# sourceMappingURL=umbrajs-three.esm.min.js.map
